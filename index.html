<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Bluetooth Serial Connection</title>
</head>
<body>
    <h1>ESP32 Bluetooth Serial Connection</h1>
    <button onclick="connectSerial()">Connect to Bluetooth</button>
    <p>Status: <span id="status">Disconnected</span></p>

    <script>
        let port;
        let writer;

        async function connectSerial() {
            try {
                // Request a serial port from the user
                port = await navigator.serial.requestPort();
                console.log('Port selected:', port);

                // Open the port (baud rate may not be needed for Bluetooth Serial)
                await port.open({ baudRate: 115200 }); // Try without baudRate if this fails
                console.log('Port opened successfully');

                // Get a writer for sending data
                writer = port.writable.getWriter();
                document.getElementById('status').innerText = 'Connected';
                console.log('Serial Port Connected');
            } catch (e) {
                console.error('Serial Connection Failed:', e);
                document.getElementById('status').innerText = 'Connection Failed';

                // Provide specific error details
                if (e.name === 'NotFoundError') {
                    console.error('No port selected by the user.');
                    alert('Please select the ESP32 serial port when prompted.');
                } else if (e.name === 'SecurityError') {
                    console.error('Permission denied or security issue.');
                    alert('Check browser permissions for serial access.');
                } else if (e.name === 'InvalidStateError') {
                    console.error('Port is already open or in an invalid state.');
                    alert('Close other applications using the port (e.g., Serial Monitor).');
                } else {
                    console.error('Unknown error:', e);
                    alert('An unexpected error occurred. Check the console for details.');
                }
            }
        }
    </script>
</body>
</html>
